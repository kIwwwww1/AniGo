# –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

## ‚úÖ –ß—Ç–æ —É–∂–µ –≥–æ—Ç–æ–≤–æ:

1. ‚úÖ Nginx –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 80
2. ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è nginx –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–ª—è certbot (location /.well-known/acme-challenge/)
3. ‚úÖ –°–∫—Ä–∏–ø—Ç `nginx/init-letsencrypt.sh` –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
4. ‚úÖ Docker volumes –¥–ª—è certbot –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–¥ –ø–æ–ª—É—á–µ–Ω–∏–µ–º SSL:

### 1. DNS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

–í–∞—à –¥–æ–º–µ–Ω **yumivo.ru** –¥–æ–ª–∂–µ–Ω —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS –∑–∞–ø–∏—Å–∏:
dig yumivo.ru +short
dig www.yumivo.ru +short

# –û–±–∞ –¥–æ–ª–∂–Ω—ã –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å IP –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- A-–∑–∞–ø–∏—Å—å –¥–ª—è `yumivo.ru` ‚Üí IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- A-–∑–∞–ø–∏—Å—å –¥–ª—è `www.yumivo.ru` ‚Üí IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–∏–ª–∏ CNAME –Ω–∞ yumivo.ru)

### 2. –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

–ü–æ—Ä—Ç **80** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
sudo ufw status
# –∏–ª–∏
sudo iptables -L -n | grep 80

# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç –ø–æ—Ä—Ç 80 –¥–ª—è HTTP
```

**–ï—Å–ª–∏ –ø–æ—Ä—Ç –∑–∞–∫—Ä—ã—Ç, –æ—Ç–∫—Ä–æ–π—Ç–µ –µ–≥–æ:**
```bash
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
```

### 3. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–æ–º–µ–Ω–∞ –∏–∑–≤–Ω–µ

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–æ–º–µ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω —Å–Ω–∞—Ä—É–∂–∏:

```bash
# –° –¥—Ä—É–≥–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –∏–ª–∏ —á–µ—Ä–µ–∑ –æ–Ω–ª–∞–π–Ω-—Å–µ—Ä–≤–∏—Å:
curl -I http://yumivo.ru/.well-known/acme-challenge/test

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç nginx (–¥–∞–∂–µ 404 - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
```

### 4. Email –∞–¥—Ä–µ—Å

–ù—É–∂–µ–Ω —Ä–∞–±–æ—á–∏–π email –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç Let's Encrypt:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π email –∞–¥—Ä–µ—Å
- –ù–∞ –Ω–µ–≥–æ –ø—Ä–∏–¥—É—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

## üöÄ –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è SSL:

```bash
cd /Users/kiww1/AniGo/nginx
./init-letsencrypt.sh yumivo.ru your@email.com
```

**–ó–∞–º–µ–Ω–∏—Ç–µ `your@email.com` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π email!**

## üìù –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:

1. Certbot —Å–æ–∑–¥–∞—Å—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ `/var/www/certbot/.well-known/acme-challenge/`
2. Let's Encrypt –ø—Ä–æ–≤–µ—Ä–∏—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —ç—Ç–∏—Ö —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ HTTP –Ω–∞ –ø–æ—Ä—Ç—É 80
3. –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ `/etc/letsencrypt/live/yumivo.ru/`
4. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å HTTPS —Å–µ–∫—Ü–∏—é –≤ nginx.conf

## ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

### –ü—Ä–æ–±–ª–µ–º–∞: "Failed to connect to yumivo.ru"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS –∑–∞–ø–∏—Å–∏, –¥–æ–º–µ–Ω –¥–æ–ª–∂–µ–Ω —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ IP —Å–µ—Ä–≤–µ—Ä–∞

### –ü—Ä–æ–±–ª–µ–º–∞: "Connection refused"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç 80 –æ—Ç–∫—Ä—ã—Ç –≤ firewall

### –ü—Ä–æ–±–ª–µ–º–∞: "Timeout"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ nginx –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω

### –ü—Ä–æ–±–ª–µ–º–∞: "Invalid response from http://yumivo.ru/.well-known/acme-challenge/"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ nginx –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ location /.well-known/ —Ä–∞–±–æ—Ç–∞–µ—Ç

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS
dig yumivo.ru +short

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–Ω–∞—Ä—É–∂–∏
curl -I http://yumivo.ru

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ nginx —Ä–∞–±–æ—Ç–∞–µ—Ç
docker ps | grep nginx

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ nginx
docker logs anigo-nginx-prod | tail -20
```

## ‚úÖ –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:

1. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ HTTPS —Å–µ–∫—Ü–∏—é –≤ `nginx/nginx.conf` (—Å—Ç—Ä–æ–∫–∏ 120-214)
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ nginx:
   ```bash
   docker-compose -f docker-compose.prod.yml restart nginx
   ```
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É HTTPS:
   ```bash
   curl -I https://yumivo.ru
   ```

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:

–î–æ–±–∞–≤—å—Ç–µ –≤ crontab –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

```bash
0 3 * * * cd /Users/kiww1/AniGo && docker-compose -f docker-compose.prod.yml run --rm certbot renew && docker-compose -f docker-compose.prod.yml restart nginx
```
