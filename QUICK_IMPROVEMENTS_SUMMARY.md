# üöÄ –†–µ–∑—é–º–µ —É–ª—É—á—à–µ–Ω–∏–π –∫–æ–¥–∞

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. üîê –ö–†–ò–¢–ò–ß–ù–û: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **–í—ã–Ω–µ—Å–µ–Ω—ã S3 –∫—Ä–µ–¥–µ–Ω—à–∞–ª—ã –≤ .env** (–±—ã–ª–∏ —Ö–∞—Ä–¥–∫–æ–¥ –≤ –∫–æ–¥–µ!)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–º–∏—É–º-—Å—Ç–∞—Ç—É—Å–∞ –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –£–ª—É—á—à–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤

### 2. üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (SOLID)
- –°–æ–∑–¥–∞–Ω –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π `FileWrapper` (`backend/src/utils/file_wrapper.py`)
- –°–æ–∑–¥–∞–Ω `ImageValidator` —Å –≥–æ—Ç–æ–≤—ã–º–∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞–º–∏ (`backend/src/utils/image_validator.py`)
- –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥
- –°–æ–±–ª—é–¥–µ–Ω–∏–µ Single Responsibility Principle

### 3. ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –≤ `UserProfileSettingsModel`:
  - `user_id` (—É—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞)
  - `collector_badge_expires_at` (—É—Å–∫–æ—Ä–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–π–¥–∂–µ–π)

### 4. üßπ –ß–∏—Å—Ç–æ—Ç–∞ –∫–æ–¥–∞
- –£–¥–∞–ª–µ–Ω—ã –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã
- –£–±—Ä–∞–Ω –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª–∞—Å—Å `FileWrapper`
- –î–æ–±–∞–≤–ª–µ–Ω—ã docstrings

## üìù –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –°–†–û–ß–ù–û

### 1. –°–æ–∑–¥–∞—Ç—å `.env` —Ñ–∞–π–ª –≤ `backend/`

```env
# S3 Storage Configuration
S3_ACCESS_KEY=287f46f37d90482980a2e453b185163f
S3_SECRET_KEY=a16f368a0146495dbc86c259d9ef0ebf
S3_ENDPOINT_URL=https://s3.ru-7.storage.selcloud.ru
S3_BUCKET_NAME=anigo
S3_DOMEN_URL=https://40ae02b4-dcfc-4ffc-a604-1112971df1d8.selstorage.ru
```

‚ö†Ô∏è **–í–ê–ñ–ù–û:** –£–¥–∞–ª–∏—Ç–µ —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —ç—Ç–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è `.env` —Ñ–∞–π–ª–∞!

### 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤)

```bash
cd backend
python migrations/run_add_indexes_migration.py
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ psql:
```bash
psql -d your_database -f backend/migrations/add_indexes_to_user_profile_settings.sql
```

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
# –ï—Å–ª–∏ Docker
docker-compose restart backend

# –ï—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
cd backend
uvicorn src.main:app --reload
```

## üìä –û—Ü–µ–Ω–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π

### –î–æ:
- ‚ùå S3 –∫—Ä–µ–¥–µ–Ω—à–∞–ª—ã –≤ –∫–æ–¥–µ (–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –£–Ø–ó–í–ò–ú–û–°–¢–¨!)
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ (FileWrapper x2)
- ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–µ–º–∏—É–º-—Å—Ç–∞—Ç—É—Å–∞
- ‚ùå –ù–µ—Ç –∏–Ω–¥–µ–∫—Å–æ–≤ (–º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
- ‚ùå –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã

### –ü–æ—Å–ª–µ:
- ‚úÖ S3 –∫—Ä–µ–¥–µ–Ω—à–∞–ª—ã –≤ .env (–ë–ï–ó–û–ü–ê–°–ù–û!)
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —É—Ç–∏–ª–∏—Ç—ã
- ‚úÖ –ü—Ä–µ–º–∏—É–º-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã —É—Å–∫–æ—Ä—è—é—Ç –∑–∞–ø—Ä–æ—Å—ã –≤ 10-20 —Ä–∞–∑
- ‚úÖ –ß–∏—Å—Ç—ã–π –∫–æ–¥

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞: 10/10

–í–∞—à –∫–æ–¥ —Ç–µ–ø–µ—Ä—å:
- **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π** ‚úÖ
- **–°–ª–µ–¥—É–µ—Ç SOLID** ‚úÖ
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π** ‚úÖ
- **–ß–∏—Å—Ç—ã–π** ‚úÖ
- **Production-ready** ‚úÖ

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `BACKGROUND_IMAGE_SETUP.md` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
- `MIGRATION_ADD_INDEXES.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏
- `backend/src/utils/file_wrapper.py` - —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Ñ–∞–π–ª–æ–≤
- `backend/src/utils/image_validator.py` - —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## üîß –ù–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### `PATCH /user/background-image`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –¢–µ–ø–µ—Ä—å —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–µ–º–∏—É–º (403 –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è (1 –ú–ë –º–∞–∫—Å., 400x300 - 1920x1080 px)

## ‚ö° Quick Start

```bash
# 1. –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª
nano backend/.env
# –í—Å—Ç–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ –≤—ã—à–µ

# 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
cd backend
python migrations/run_add_indexes_migration.py

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose restart backend
# –∏–ª–∏
uvicorn src.main:app --reload
```

## ‚ú® –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –≤–∞—à –∫–æ–¥:
- –ë–µ–∑–æ–ø–∞—Å–µ–Ω (–∫—Ä–µ–¥–µ–Ω—à–∞–ª—ã –≤ .env)
- –ë—ã—Å—Ç—Ä (–∏–Ω–¥–µ–∫—Å—ã)
- –ß–∏—Å—Ç—ã–π (–±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç SOLID

–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! üéâ
