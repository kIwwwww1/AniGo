# üìã –î–∞–Ω–Ω—ã–µ, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π –ø—Ä–æ–µ–∫—Ç–∞ AniGo –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

---

## üåê 1. –î–û–ú–ï–ù–ù–´–ï –ò–ú–ï–ù–ê (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

### –û—Å–Ω–æ–≤–Ω–æ–π –¥–æ–º–µ–Ω
- **–û—Å–Ω–æ–≤–Ω–æ–π –¥–æ–º–µ–Ω:** `example.com` (–Ω–∞–ø—Ä–∏–º–µ—Ä: `yumivo.ru`)
- **–° –ø–æ–¥–¥–æ–º–µ–Ω–æ–º www:** `www.example.com` (–Ω–∞–ø—Ä–∏–º–µ—Ä: `www.yumivo.ru`)

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`nginx/nginx.prod.conf`, `nginx/nginx.conf.template`)
- SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã Let's Encrypt
- CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (`ALLOWED_ORIGINS`)
- –°—Å—ã–ª–∫–∏ –≤ email –ø–∏—Å—å–º–∞—Ö (`FRONTEND_URL`)

---

## üîê 2. –ë–ê–ó–ê –î–ê–ù–ù–´–• PostgreSQL (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

### –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
- **POSTGRES_USER** - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë–î (–Ω–∞–ø—Ä–∏–º–µ—Ä: `anigo_user`)
- **POSTGRES_PASSWORD** - –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å –¥–ª—è –ë–î (–º–∏–Ω–∏–º—É–º 16 —Å–∏–º–≤–æ–ª–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã)
- **POSTGRES_DB** - –Ω–∞–∑–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–æ–±—ã—á–Ω–æ: `anigo`)
- **DB_HOST** - —Ö–æ—Å—Ç –ë–î (–≤ Docker: `db`, –ª–æ–∫–∞–ª—å–Ω–æ: `localhost`)
- **DB_PORT** - –ø–æ—Ä—Ç –ë–î (–æ–±—ã—á–Ω–æ: `5432`)

**–ü—Ä–∏–º–µ—Ä:**
```env
POSTGRES_USER=anigo_user
POSTGRES_PASSWORD=–í–∞—à–ù–∞–¥–µ–∂–Ω—ã–π–ü–∞—Ä–æ–ª—å123!@#
POSTGRES_DB=anigo
DB_HOST=db
DB_PORT=5432
```

---

## üîë 3. JWT –ò –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

### –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è JWT —Ç–æ–∫–µ–Ω–æ–≤:
- **SECRET_KEY** - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ JWT —Ç–æ–∫–µ–Ω–æ–≤ (–º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞)

**–ö–∞–∫ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å:**
```bash
python3 -c "import secrets; print(secrets.token_urlsafe(32))"
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
- **ALGORITHM** - –∞–ª–≥–æ—Ä–∏—Ç–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `HS256`)
- **COOKIES_SESSION_ID_KEY** - –∏–º—è cookie –¥–ª—è —Å–µ—Å—Å–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `session_id`)
- **SECURE_COOKIES** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å secure cookies –¥–ª—è HTTPS (`true`/`false`, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `false`)

**–ü—Ä–∏–º–µ—Ä:**
```env
SECRET_KEY=–≤–∞—à_—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π_–∫–ª—é—á_–º–∏–Ω–∏–º—É–º_32_—Å–∏–º–≤–æ–ª–∞
ALGORITHM=HS256
COOKIES_SESSION_ID_KEY=session_id
SECURE_COOKIES=true  # –î–ª—è HTTPS
```

---

## üìß 4. SMTP –ù–ê–°–¢–†–û–ô–ö–ò (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

### –î–∞–Ω–Ω—ã–µ –ø–æ—á—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞:

#### –í–∞—Ä–∏–∞–Ω—Ç A: Gmail
- **SMTP_HOST** - `smtp.gmail.com`
- **SMTP_PORT** - `587`
- **SMTP_USER** - –≤–∞—à email (–Ω–∞–ø—Ä–∏–º–µ—Ä: `your-email@gmail.com`)
- **SMTP_PASSWORD** - –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Gmail (–ù–ï –æ–±—ã—á–Ω—ã–π –ø–∞—Ä–æ–ª—å!)
- **SMTP_FROM_EMAIL** - email –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è (–æ–±—ã—á–Ω–æ —Ç–æ—Ç –∂–µ, —á—Ç–æ –∏ SMTP_USER)

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Gmail:**
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: https://myaccount.google.com/apppasswords
2. –°–æ–∑–¥–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è "–ü–æ—á—Ç–∞"
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –ø–∞—Ä–æ–ª—å –≤ `SMTP_PASSWORD`

#### –í–∞—Ä–∏–∞–Ω—Ç B: reg.ru / Yandex / –î—Ä—É–≥–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
- **SMTP_HOST** - –∞–¥—Ä–µ—Å SMTP —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `mail.hosting.reg.ru` –∏–ª–∏ `smtp.yandex.ru`)
- **SMTP_PORT** - –ø–æ—Ä—Ç SMTP (–æ–±—ã—á–Ω–æ: `587` –∏–ª–∏ `465`)
- **SMTP_USER** - email –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `noreply@yourdomain.ru`)
- **SMTP_PASSWORD** - –ø–∞—Ä–æ–ª—å –æ—Ç –ø–æ—á—Ç–æ–≤–æ–≥–æ —è—â–∏–∫–∞
- **SMTP_FROM_EMAIL** - email –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è

**–ü—Ä–∏–º–µ—Ä –¥–ª—è reg.ru:**
```env
SMTP_HOST=mail.hosting.reg.ru
SMTP_PORT=587
SMTP_USER=noreply@yourdomain.ru
SMTP_PASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å_–æ—Ç_–ø–æ—á—Ç—ã
SMTP_FROM_EMAIL=noreply@yourdomain.ru
```

### URL —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –¥–ª—è —Å—Å—ã–ª–æ–∫ –≤ –ø–∏—Å—å–º–∞—Ö:
- **FRONTEND_URL** - –ø–æ–ª–Ω—ã–π URL –≤–∞—à–µ–≥–æ —Å–∞–π—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://yourdomain.ru`)

**–ü—Ä–∏–º–µ—Ä:**
```env
FRONTEND_URL=https://yourdomain.ru
```

---

## üåç 5. CORS –ù–ê–°–¢–†–û–ô–ö–ò (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

### –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã –¥–ª—è CORS:
- **ALLOWED_ORIGINS** - —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é

**–ü—Ä–∏–º–µ—Ä:**
```env
ALLOWED_ORIGINS=https://yourdomain.ru,https://www.yourdomain.ru
```

**–í–∞–∂–Ω–æ:** –£–∫–∞–∑—ã–≤–∞–π—Ç–µ –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –¥–æ–º–µ–Ω–∞ (—Å www –∏ –±–µ–∑ www), –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –æ–±–∞.

---

## ‚òÅÔ∏è 6. S3 –•–†–ê–ù–ò–õ–ò–©–ï (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û)

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ S3 –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ (–∞–≤–∞—Ç–∞—Ä—ã, —Ñ–æ–Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è):

- **S3_ACCESS_KEY** - –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞ –∫ S3
- **S3_SECRET_KEY** - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á S3
- **S3_ENDPOINT_URL** - URL endpoint S3 (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://s3.ru-7.storage.selcloud.ru`)
- **S3_BUCKET_NAME** - –Ω–∞–∑–≤–∞–Ω–∏–µ bucket (–Ω–∞–ø—Ä–∏–º–µ—Ä: `anigo`)
- **S3_DOMEN_URL** - –ø—É–±–ª–∏—á–Ω—ã–π URL bucket (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://your-bucket-id.selstorage.ru`)

**–ü—Ä–∏–º–µ—Ä:**
```env
S3_ACCESS_KEY=your_s3_access_key
S3_SECRET_KEY=your_s3_secret_key
S3_ENDPOINT_URL=https://s3.ru-7.storage.selcloud.ru
S3_BUCKET_NAME=anigo
S3_DOMEN_URL=https://your-bucket-id.selstorage.ru
```

---

## ‚öôÔ∏è 7. –û–ö–†–£–ñ–ï–ù–ò–ï –ò –ü–£–¢–ò (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

- **ENVIRONMENT** - –æ–∫—Ä—É–∂–µ–Ω–∏–µ (`production` –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
- **AVATARS_BASE_PATH** - –±–∞–∑–æ–≤—ã–π –ø—É—Ç—å –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤ (–æ–±—ã—á–Ω–æ: `/app`)

**–ü—Ä–∏–º–µ—Ä:**
```env
ENVIRONMENT=production
AVATARS_BASE_PATH=/app
```

---

## üîÑ 8. REDIS (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:

- **REDIS_URL** - –ø–æ–ª–Ω—ã–π URL Redis (–Ω–∞–ø—Ä–∏–º–µ—Ä: `redis://redis:6379/0`)

**–ò–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
- **REDIS_HOST** - —Ö–æ—Å—Ç Redis (–≤ Docker: `redis`)
- **REDIS_PORT** - –ø–æ—Ä—Ç Redis (–æ–±—ã—á–Ω–æ: `6379`)
- **REDIS_DB** - –Ω–æ–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Redis (–æ–±—ã—á–Ω–æ: `0`)

**–ü—Ä–∏–º–µ—Ä:**
```env
REDIS_URL=redis://redis:6379/0
```

---

## üìù 9. SSL –°–ï–†–¢–ò–§–ò–ö–ê–¢–´ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è HTTPS)

### –î–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ Let's Encrypt:
- **–î–æ–º–µ–Ω** - –≤–∞—à –¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä: `yourdomain.ru`)
- **Email** - email –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π Let's Encrypt (–Ω–∞–ø—Ä–∏–º–µ—Ä: `admin@yourdomain.ru`)

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
cd nginx
./init-letsencrypt.sh yourdomain.ru admin@yourdomain.ru
```

---

## üñ•Ô∏è 10. –°–ï–†–í–ï–†–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø

### –î–∞–Ω–Ω—ã–µ –æ —Å–µ—Ä–≤–µ—Ä–µ:
- **IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞** - –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS –∑–∞–ø–∏—Å–µ–π
- **SSH –¥–æ—Å—Ç—É–ø** - –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É
- **–ü–æ—Ä—Ç—ã** - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—Ç–∫—Ä—ã—Ç—ã –ø–æ—Ä—Ç—ã:
  - `80` (HTTP)
  - `443` (HTTPS)
  - `22` (SSH)

---

## üìã –ß–ï–ö–õ–ò–°–¢ –ü–ï–†–ï–î –ü–£–ë–õ–ò–ö–ê–¶–ò–ï–ô

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- [ ] –û—Å–Ω–æ–≤–Ω–æ–π –¥–æ–º–µ–Ω –∏ www –ø–æ–¥–¥–æ–º–µ–Ω
- [ ] –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ PostgreSQL (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –ø–∞—Ä–æ–ª—å, –ë–î)
- [ ] SECRET_KEY –¥–ª—è JWT (—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω)
- [ ] SMTP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (—Ö–æ—Å—Ç, –ø–æ—Ä—Ç, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –ø–∞—Ä–æ–ª—å)
- [ ] FRONTEND_URL –¥–ª—è —Å—Å—ã–ª–æ–∫ –≤ –ø–∏—Å—å–º–∞—Ö
- [ ] ALLOWED_ORIGINS –¥–ª—è CORS
- [ ] ENVIRONMENT=production
- [ ] AVATARS_BASE_PATH

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- [ ] S3 –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- [ ] REDIS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- [ ] Email –¥–ª—è Let's Encrypt
- [ ] IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞

---

## üöÄ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢

### –®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`
```bash
cp env.example .env
```

### –®–∞–≥ 2: –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`

### –®–∞–≥ 3: –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ SECRET_KEY
```bash
python3 -c "import secrets; print(secrets.token_urlsafe(32))"
```

### –®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç–µ Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
–ó–∞–º–µ–Ω–∏—Ç–µ `YOUR_DOMAIN` –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω –≤ —Ñ–∞–π–ª–∞—Ö:
- `nginx/nginx.prod.conf`
- `nginx/nginx.conf.template`

### –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ DNS
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ A-–∑–∞–ø–∏—Å–∏ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ IP —Å–µ—Ä–≤–µ—Ä–∞.

---

## üìû –ù–£–ñ–ù–ê –ü–û–ú–û–©–¨?

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- `DEPLOYMENT.md` - –æ–±—â–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é
- `DEPLOYMENT_SIMPLE.md` - —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- `DEPLOYMENT_VPS_SWEB.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è VPS sweb.ru
- `DEPLOYMENT_PORTAINER.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è Portainer
